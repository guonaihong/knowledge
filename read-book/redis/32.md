# Redis主从同步与故障切换问题解析

## 主从数据不一致问题

- **原因**：Redis采用异步复制，导致主从数据可能不同步。
- **解决方法**：
  1. 保证良好的网络环境。
  2. 使用程序监控从库复制进度，超过阈值时不让客户端连接从库。

## 读取过期数据问题

- **原因**：由Redis的过期数据删除策略（惰性删除和定期删除）导致。
- **解决方法**：
  1. 使用Redis 3.2及以上版本。
  2. 使用`EXPIREAT`/`PEXPIREAT`命令设置过期时间点，保证主从节点时钟一致。

## 不合理配置项导致服务挂掉问题

### protected-mode配置项

- **问题**：限制哨兵实例访问，若设置为`yes`且部署在其他服务器，哨兵实例间无法通信。
- **解决方法**：设置`protected-mode`为`no`，`bind`配置项设置为其他哨兵实例IP地址。

### cluster-node-timeout配置项

- **问题**：设置Redis Cluster实例响应心跳消息的超时时间，超时可能导致集群服务挂掉。
- **解决方法**：调大`cluster-node-timeout`配置项（例如10到20秒）。

## 小结

- 汇总了主从同步时可能遇到的3个问题及其成因和解决方法。
