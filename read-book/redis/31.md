# Redis事务机制：ACID属性保证

## 原子性（Atomicity）

- 事务中命令入队时报错：放弃事务，保证原子性。
- 命令实际执行时报错：不保证原子性。
- 实例故障时：AOF日志开启可保证原子性。

## 一致性（Consistency）

- 命令入队时报错：事务放弃，保证一致性。
- 实际执行时报错：有错误的命令不执行，保证一致性。
- 实例故障：根据数据恢复方式（RDB或AOF）保证一致性。

## 隔离性（Isolation）

- 并发操作在EXEC命令前：使用WATCH机制，可放弃事务以保证隔离性。
- 并发操作在EXEC命令后：单线程执行，保证隔离性。

## 持久性（Durability）

- 无RDB或AOF：持久性属性无法保证。
- 使用RDB：事务数据可能无法持久化。
- 使用AOF：持久性属性仍无法保证。

## 事务命令

- `MULTI`：开启事务。
- `EXEC`：提交事务，执行命令队列中的操作。
- `DISCARD`：放弃事务，清空命令队列。
- `WATCH`：监控键值变化，变更则放弃事务。

## 小结

- Redis事务机制保证一致性和隔离性，但不保证持久性。
- 原子性在命令语法正确时得到保证。

## 每课一问

- 如果Redis实例发生故障，使用RDB机制，事务的原子性能否保证？

## 建议

- 严格遵循Redis命令规范开发程序。
- 通过code review确保命令正确性。
