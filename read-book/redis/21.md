# Redis缓冲区知识点总结

## 缓冲区基本概念

- 缓冲区用于避免因数据或命令处理速度慢于发送速度而导致的数据丢失和性能问题。
- 缓冲区内存空间有限，写入速度持续大于读取速度会导致内存溢出。

## 缓冲区溢出问题

- 缓冲区溢出可能导致数据丢失。
- 不设置缓冲区大小上限会导致Redis实例崩溃。

## 缓冲区应用场景

1. 客户端和服务器端通信时暂存数据。
2. 主从节点间数据同步时暂存写命令和数据。

## 客户端输入和输出缓冲区

- 服务器端为每个连接的客户端设置输入缓冲区和输出缓冲区。
- 输入缓冲区暂存客户端发送的命令，主线程处理后写入输出缓冲区返回给客户端。

## 缓冲区溢出应对策略

### 输入缓冲区溢出

- 避免写入bigkey或服务器端处理请求速度过慢。
- 使用`CLIENT LIST`命令查看输入缓冲区使用情况。

### 输出缓冲区溢出

- 避免bigkey操作返回大量数据结果。
- 避免长时间使用`MONITOR`命令。
- 使用`client-output-buffer-limit`配置项设置缓冲区大小。

## 主从集群缓冲区

### 复制缓冲区

- 主节点在全量复制期间，写命令暂存于复制缓冲区。
- 避免溢出可通过控制主节点数据量和设置`client-output-buffer-limit`。

### 复制积压缓冲区

- 用于增量复制，暂存主节点写命令供从节点网络恢复后同步。
- 调整`repl_backlog_size`参数避免溢出。

## 缓冲区溢出影响

- 导致网络连接关闭或命令数据丢失。
- 根据溢出原因，采取相应策略：避免bigkey、减少阻塞操作、合理设置缓冲区大小。
