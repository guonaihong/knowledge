# Redis持久化知识点总结

## 1. 持久化方法

- **AOF持久化**：记录每次执行的操作命令，对性能影响较小，但恢复时需要逐一执行日志中的命令。
- **内存快照**：记录某一时刻内存中的数据状态，通过RDB文件实现快速恢复。

## 2. RDB文件

- RDB是Redis DataBase的缩写。
- 通过`save`或`bgsave`命令生成。
  - `save`：在主线程中执行，会导致阻塞。
  - `bgsave`：创建子进程执行，避免主线程阻塞。

## 3. 写时复制（Copy-On-Write, COW）

- 允许在快照执行期间修改数据，保证快照完整性的同时不影响数据的写操作。

## 4. 快照的频率和影响

- 快照不能过于频繁，以免影响性能和磁盘压力。
- 快照间隔时间（t）越小，数据丢失的风险越低。

## 5. 增量快照

- 只对修改的数据进行快照，减少全量快照的开销。
- 需要额外的元数据记录哪些数据被修改。

## 6. Redis 4.0混合持久化方法

- 结合AOF日志和内存快照，减少对性能的影响，同时减少数据丢失。

## 7. 持久化选择建议

- 数据不能丢失时，推荐使用RDB和AOF的混合持久化。
- 允许分钟级数据丢失时，可以仅使用RDB。
- 仅使用AOF时，推荐使用`everysec`配置选项。

## 8. 风险分析

- 在CPU和内存资源有限的情况下，使用RDB持久化可能面临性能瓶颈。

## 9. 社区讨论

- 讨论了`fork`操作、写时复制、以及不同QPS下的持久化策略等问题。

## 10. 备份的重要性

- 即使Redis服务崩溃，备份也可用于快速恢复数据，避免重新写入所有数据的耗时过程。
