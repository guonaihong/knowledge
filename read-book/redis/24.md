# 缓存替换策略

## 缓存容量设置

根据数据访问的局部性原理，通常设置缓存容量为总数据量的20%，但需结合实际业务场景确定。

## 缓存淘汰机制

缓存空间有限，需通过淘汰机制处理满缓存情况。
Redis缓存淘汰策略
Redis 4.0之前有6种策略，4.0之后增加到8种。

### 不进行淘汰的策略

noeviction：不淘汰数据，写满后返回错误。

### 会进行淘汰的策略

1. 在设置了过期时间的数据中进行淘汰

volatile-random：随机淘汰
volatile-ttl：根据过期时间先后淘汰
volatile-lru：使用LRU算法淘汰
volatile-lfu：使用LFU算法淘汰（Redis 4.0后新增）
2. 在所有数据范围内进行淘汰

allkeys-lru：使用LRU算法淘汰
allkeys-random：随机淘汰
allkeys-lfu：使用LFU算法淘汰（Redis 4.0后新增）

## LRU算法

全称：Least Recently Used
工作机制：将数据组织成链表，新访问的数据移至最近最常使用(MRU)端，淘汰最不常用(LRU)端的数据。
Redis实现：简化版，记录数据的访问时间戳，随机选取N个数据作为候选集，淘汰lru字段值最小的数据。

## 数据淘汰后的处理

    干净数据：直接删除。
    脏数据：需写回数据库，保证数据最新性。
    Redis直接删除被淘汰的数据，不考虑数据是否被修改。

## 使用建议

    1. 优先使用allkeys-lru策略，适用于有明显冷热数据区分的业务。
    1. 数据访问频率相差不大时，使用allkeys-random策略。
    1. 对于需要置顶的数据，使用volatile-lru策略，不设置过期时间。

## 缓存容量大小设置

    结合数据总量、热数据量和成本预算，设置在总数据量的15%到30%。

## 小结

    缓存替换策略和被淘汰数据的处理方法对缓存性价比至关重要。
    选择合适的淘汰策略，考虑是否有始终频繁访问的数据，合理设置缓存容量。
