# 知识点总结

## 临时表的特性和应用
临时表在MySQL中有以下特性：
- 使用`CREATE TEMPORARY TABLE`语法创建。
- 只能被创建它的session访问，对其他线程不可见。
- 可以与普通表同名。
- 在`SHOW CREATE TABLE`和DML语句中优先使用临时表。
- `SHOW TABLES`命令不显示临时表。
- 临时表在session结束时自动删除。

### 临时表的应用场景
- 临时表适合用于处理复杂的计算逻辑。
- 在分库分表系统中，临时表可用于跨库查询优化。

### 分库分表系统
- 将一个大表按照某个字段拆分到多个数据库实例上。
- 使用分区key减少跨库和跨表查询。
- 临时表可以用于汇总跨库查询的结果。

### 临时表的存储机制
- 临时表的frm文件存储在临时文件目录下，文件名包含进程ID和线程ID。
- MySQL 5.6之前的版本会在临时文件目录下创建以.ibd为后缀的数据文件。
- 5.7版本开始使用临时文件表空间存储临时表数据，不再创建ibd文件。

### 临时表和主备复制
- 临时表操作在`binlog_format=statement/mixed`时会记录到binlog中。
- 备库通过记录的线程ID区分同名的临时表。
- `DROP TEMPORARY TABLE`命令在binlog中记录，以保证主备复制的一致性。

### 临时表的命名规则
- 临时表的`table_def_key`由库名、表名、server_id和thread_id组成。
- 每个线程维护自己的临时表链表，优先操作临时表。

### 临时表与内部临时表
- 用户临时表是用户显式创建的。
- 内部临时表由MySQL内部创建，用于优化查询。

### 思考题
- 为什么可以使用`ALTER TABLE`修改临时表名，而不能使用`RENAME`？

## 小结
- 临时表是MySQL中重要的技术工具，适合于复杂查询优化和分库分表系统中的应用。
- 临时表的特性使其在多线程环境下使用更加灵活，减少了数据清理和异常处理的工作。
- 在`binlog_format=row`时，临时表操作不记录到binlog中，简化了日志管理。

## 问题讨论
- 如何选择`binlog_format`以适应不同的应用场景？
- 临时表在主备复制中的处理机制是什么？

## 结论
- 临时表在MySQL中的应用非常灵活，能够解决复杂查询和分库分表系统中的问题。
- 临时表减少了数据处理的额外工作，提高了数据库操作的效率。