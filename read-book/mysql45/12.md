## 1. 数据库抖动现象

- 数据库执行SQL语句时，偶尔会出现性能突然下降，难以复现的现象，称为"抖动"。

## 2. 抖动原因分析

- **WAL机制**：InnoDB通过WAL（Write-Ahead Logging）机制，先写日志后写磁盘，提高性能。
- **Redo Log**：重做日志，用于记录变更操作，确保数据的持久性。
- **脏页**：内存中数据与磁盘上数据不一致的页称为脏页，需要写入磁盘以保持数据一致性。

## 3. 导致抖动的几种情况

- **Redo Log写满**：需要停止更新操作，将checkpoint向前推进，确保日志空间。
- **系统内存不足**：需要淘汰一些数据页，空出内存给其他数据页使用，如果淘汰的是脏页，需要先写入磁盘。
- **MySQL空闲时**：后台线程会刷脏页，减少脏页比例。
- **数据库关闭**：MySQL关闭时，会将所有脏页写入磁盘，加快启动速度。

## 4. 性能影响分析

- **查询响应时间变长**：查询过程中可能需要等待脏页刷写完成。
- **更新操作阻塞**：日志写满时，更新操作会被阻塞，直到日志空间释放。

## 5. InnoDB脏页控制策略

- **innodb_io_capacity**：设置磁盘IOPS，影响脏页刷写速度。
- **innodb_max_dirty_pages_pct**：设置脏页比例上限，默认值为75%。

## 6. 监控与优化

- 监控脏页比例，避免接近上限。
- 合理设置`innodb_io_capacity`，根据磁盘性能调整。
- 关注`Innodb_buffer_pool_pages_dirty`和`Innodb_buffer_pool_pages_total`指标。

## 7. 特殊策略

- **innodb_flush_neighbors**：控制是否将相邻的脏页一起刷写，默认在MySQL 8.0中为0。

## 8. 思考题

- 如果将Redo Log设置过小，如1个100M的文件，可能会频繁触发日志写满的情况，导致更新操作阻塞。

## 9. 索引创建方法

- 学号字段创建索引时，可以考虑使用数字类型存储，减少存储空间，提高查询效率。
