## 索引选择：普通索引 vs 唯一索引

- **普通索引**：在查询和更新过程中，如果找到符合条件的记录后，需要继续查找下一个记录，直到找到不满足条件的第一个记录。
- **唯一索引**：由于索引定义了唯一性，查找到第一个满足条件的记录后，就会停止继续搜索。
- **性能差异**：在查询过程中，两者的性能差异微乎其微。

## 索引更新过程

- **Change Buffer**：InnoDB会将更新操作缓存在Change Buffer中，减少磁盘读取，提高性能。
- **应用场景**：对于写多读少的业务模型，Change Buffer能够显著提升更新性能。
- **限制**：唯一索引的更新不能使用Change Buffer，只有普通索引可以使用。

## Change Buffer 与 Redo Log 的比较

- **Redo Log**：主要节省的是随机写磁盘的IO消耗，通过顺序写入提高性能。
- **Change Buffer**：主要节省的则是随机读磁盘的IO消耗，通过缓存更新减少磁盘访问。

## 索引选择建议

- **业务正确性优先**：如果业务代码已经保证不会写入重复数据，从性能角度出发建议优先考虑非唯一索引。
- **归档库场景**：可以考虑使用普通索引以提高归档效率。

## 事务版本可见性规则

- 活跃事务的判断：如果事务在其他事务视图数组创建的瞬间是活跃的，属于"版本未提交，不可见"。

## 思考题

- 如果机器掉电重启，Change Buffer是否会丢失？这将如何影响数据的完整性？

## 其他讨论

- **系统表空间与数据表空间**：系统表空间对应文件`ibdata1`，数据表空间对应文件`表名.ibd`。
- **Change Buffer的持久化**：Change Buffer的数据会持久化到`ibdata`文件中。
