# Apache Pulsar 订阅概念总结

## 订阅定义

- 订阅是Apache Pulsar中描述消费者身份及消费消息方式的抽象和配置。

## Pulsar Broker 角色

- Pulsar Broker负责管理订阅，是主题或主题分区的所有者。

## 订阅包含的元数据

- 主题的名称（或主题分区的名称）
- 订阅的名称
- 消息过期细节
- 订阅的游标

## 游标

- 游标是Pulsar Broker追踪消费者在日志中消费位置的机制。
- 类似于文字处理软件中的光标，指示当前位置。

## 游标的存储

- Pulsar将游标的偏移量存储在Apache BookKeeper的游标Ledger中。

## 订阅类型

- **独占(Exclusive)**: 保证消费者和订阅之间的一对一关系。
- **共享(Shared)**: 多个消费者以轮询方式接收主题中的消息。
- **键共享(Key_Shared)**: 消费者只能消费特定键或键区间的消息。
- **故障转移(Failover)**: 多个消费者连接至主题，但只有一个“首领”消费者接收消息。

## 独占订阅的特点

- 简单性
- 顺序保证

## 共享订阅的特点

- 简单性
- 消息以轮询方式投递
- 无法保证消息的顺序性
- 逐条消息确认机制

## 键共享订阅的特点

- 消费者按键或键区间消费消息
- 支持自动哈希和粘性哈希分配键
- 保证消息顺序性

## 故障转移订阅的特点

- 保证顺序性
- 支持累积确认
- 一个“首领”消费者接收消息，后备消费者在首领离线时接收消息

## 确认(Acknowledgment)

- 确认是Pulsar中的一个重要概念，将在后续章节详细介绍。
