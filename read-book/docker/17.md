# 容器网络配置知识点总结

## 容器网络接口配置方式

- **veth**: 大部分容器使用的默认网络配置方式。
- **macvlan** 和 **ipvlan**: 其他可选的网络配置方式。

## 容器网络性能影响

- 使用veth接口配置可能导致网络延时增加，尤其是对网络性能要求高的应用程序。

## 问题重现与测试

- 使用 **netperf** 工具进行网络性能测试。
- 测试包括在宿主机和容器中运行netperf，比较两者的网络延时。

## 测试配置

- 需要两台虚拟机或物理机，且它们处于同一个二层网络中。

## 测试结果

- 在宿主机上运行netperf TCP_RR测试，得到平均Transactions为2446/s。
- 在容器中运行相同测试，得到平均Transactions为2141/s，下降了约12.5%。

## 问题分析

- veth接口配置导致数据包在发送和接收时增加了一次接口层的处理，增加了网络延时。
- veth操作涉及软中断处理，增加了额外开销。

## 解决方法

- 考虑使用macvlan或ipvlan配置方式替代veth，以减少网络延时。

## macvlan 和 ipvlan 特点

- 两者都在物理网络接口上配置虚拟网络接口，并可配置独立IP。
- **macvlan**: 每个虚拟接口有独立MAC地址。
- **ipvlan**: 虚拟接口与物理接口共享MAC地址。

## 配置示例

- 使用Docker和Linux命令手动配置ipvlan网络接口。

## 性能优化

- 通过选择更合适的网络接口配置方式，可以降低容器中的网络延时，提高应用程序性能。
